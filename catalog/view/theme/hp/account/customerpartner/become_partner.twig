{{ header }}
<link href="catalog/view/theme/hp/stylesheet/become_partner.css" rel="stylesheet" type="text/css" />

<div style="display: flex; flex-direction: column; min-height: 100vh;">
<nav id="checkout-checkout" class="container mb-4 mt-4" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
      {% for breadcrumb in breadcrumbs %}
        <li class="breadcrumb-item">
          <a class="text-decoration-none text-black" href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
        </li>
      {% endfor %}
    </ol>
  </nav>
{% if separate_view is defined and separate_view %}
  <div class="container-fluid" id="content">
{% else %}
  <div class="container d-flex" id="content">
{% endif %}

  {{ column_right }}
    {% if success %}
      <div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> {{ success }}</div>
    {% endif %}
    {% if error_warning %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}</div>
    {% endif %}

    <div class="row col-sm-8">
      <div class="d-flex justify-content-center">
        {% if isMember %}
          {% if not in_process %}
        <form action="{{ action }}" method="post" enctype="multipart/form-data" class="form-horizontal">
          <h1>Be a MeowChant</h1>
          {% if customer_id %}
            <p class="mb-4">Customer ID: {{ customer_id }}</p>
          {% endif %}

          <div class="form-group required">
            <label class="col-sm-12" for="input-shoppartner">Shop name</label>
            <div class="col-sm-12">
              <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-search"></i></span>
                <input type="text" name="shoppartner" value="{{ shoppartner }}" id="input-shoppartner" class="form-control" />
              </div>
              {% if error_shoppartner %}<div class="text-danger">{{ error_shoppartner }}</div>{% endif %}
            </div>
          </div>

          <div class="form-group required">
            <label class="col-sm-12" for="input-entry">Store Description</label>
            <div class="col-sm-12">
              <textarea id="input-entry" name="description" class="form-control" rows="3">{{ description }}</textarea>
              {% if error_description %}<div class="text-danger">{{ error_description }}</div>{% endif %}
            </div>
          </div>

          <h3 class="mt-5 mb-4">Upload your Documents:</h3>

          <div class="document-upload-section">
            {% set uploads = [
              { id: 'dtifile', label: 'DTI/SEC Certificate', error: error_dtifile },
              { id: 'birfile', label: 'BIR 2303/TIN', error: error_birfile },
              { id: 'mayorfile', label: "Mayor's Permit", error: error_mayorfile },
              { id: 'validid', label: "Government Valid ID", error: error_validid }
            ] %}

            {% for doc in uploads %}
            <div class="form-group required">
              <label class="control-label" for="{{ doc.id }}">{{ doc.label }}:</label>
              <div class="custom-file-upload">
                <input type="file" name="{{ doc.id }}" id="{{ doc.id }}">
                <label for="{{ doc.id }}" class="file-upload-button">Choose File</label>
                <span class="file-name">No file chosen</span>
              </div>
              {% if doc.error %}<div class="text-danger w-100 mt-2">{{ doc.error }}</div>{% endif %}
            </div>
            {% endfor %}
          </div>

          <div class="text-center mt-5 mb-3">
            <input type="submit" value="Continue" class="btn btn-primary btn-lg" style="background-color: #162F65; border-color: #162F65; border-radius: 25px; padding: 10px 40px;"/>
          </div>
        </form>

          {% elseif in_process == 'rejected' %}
          <div class="alert alert-info">
            <i class="fa fa-exclamation-circle"></i> {{ text_delay}}
            {% if rejection_comment %}
              <div class="alert alert-warning" style="margin-top:10px;">
                <strong>Reason for rejection:</strong> {{ rejection_comment }}
              </div>
            {% endif %}
            <form method="post" action="{{ action }}" style="display:inline;">
              <input type="hidden" name="reapply" value="1" />
              <button type="submit" class="btn btn-warning">Re-apply</button>
            </form>
          </div>

        {% else %}
          <div class="alert alert-info"><i class="fa fa-exclamation-circle"></i> {{ text_delay}}</div>
        {% endif %}
        {% else %}
        <div class="text-danger">
          {{ error_warning_authenticate}}
        </div>
      {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
    // Display selected filename
    $('.custom-file-upload input[type="file"]').on('change', function() {
        const fileName = $(this).val().split('\\').pop();
        const $fileNameSpan = $(this).siblings('.file-name');
        $fileNameSpan.text(fileName || 'No file chosen');
    });

    // Shop name availability check
    $('#input-shoppartner').on('change', function() {
        var $this = $(this);
        var shop = $this.val();

        if (shop) {
            var $addon = $this.closest('.input-group').find('.input-group-addon');
            $addon.html('<i class="fa fa-spinner fa-spin"></i>');

            $.ajax({
                type: 'POST',
                url: 'index.php?route=customerpartner/sell/wkmpregistation',
                data: { shop: shop },
                dataType: 'json',
                success: function(data) {
                    if (data.success) {
                        $addon.html('<span data-toggle="tooltip" class="text-success" title="{{ text_avaiable }}"><i class="fa fa-thumbs-o-up"></i></span>');
                    } else {
                        $addon.html('<span data-toggle="tooltip" class="text-danger" title="{{ text_no_avaiable }}"><i class="fa fa-thumbs-o-down"></i></span>');
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    $addon.html('<i class="fa fa-search"></i>');
                }
            });
        }
    });
});
</script>

{{ footer }}