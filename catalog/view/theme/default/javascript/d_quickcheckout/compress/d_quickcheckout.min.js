
var qc=(function(){riot.observable(this);this.action_pending=[];this.layout=[];this.number_requests=0;this.createStore=function(state){this.state=state
this.stateOld=JSON.parse(JSON.stringify(state));this.beforeLeave();return this;};this.updateState=function(key,data,is_upd=true){var path=d_quickcheckout_lodash.join(key,'.');d_quickcheckout_lodash.set(this.state,path,data);this.state.edited=true;if(is_upd){setTimeout(function(){riot.update();},10);}};this.loading=function(state){var edited=this.state.edited;if(!state){d_quickcheckout_lodash.set(this.state,'loading',state);}
d_quickcheckout_lodash.set(this.state,'session.confirm.loading',state);this.state.edited=edited;setTimeout(function(){riot.update();},10);};this.render=function(){riot.update();};this.setState=function(data,is_upd=true){this.state=d_quickcheckout_lodash.merge(this.state,data);this.state.edited=true;if(is_upd){setTimeout(function(){riot.update();},10);}};this.getState=function(){return this.state;};this.in_array=function(needle,haystack){var length=haystack.length;for(var i=0;i<length;i++){if(typeof haystack[i]=='object'){if(arrayCompare(haystack[i],needle))return true;}else{if(haystack[i]==needle)return true;}}
return false;};this.decodeHTML=function(html){var txt=document.createElement('textarea');txt.innerHTML=html;return txt.value;};this.getConfig=function(){return this.state.config[this.getAccount()];};this.getSession=function(){return this.state.session;};this.getLayout=function(){return this.state.layout;};this.getAccount=function(){return this.state.session.account;};this.getLanguage=function(){return this.state.language;};this.getError=function(){if(!this.state.errors){this.state.errors={};}
return this.state.errors;};this.getChange=function(){return getDiff(this.stateOld,this.state);};this.setChange=function(state){this.stateOld=JSON.parse(JSON.stringify(state));};this.dispatch=function(action,state){this.trigger(action,state);};this.subscribe=function(action,callback){this.on(action,callback);};this.rand=function(){return Math.random().toString(36).substring(2,9);};this.stripTags=function(text){if(text){return text.replace(/<\/?[^>]+(>|$)/g,"");}};this.isEmpty=function(obj){if(typeof(obj)=='undefined'){return true;}
for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return JSON.stringify(obj)===JSON.stringify({});};this.sortItems=function(items){var items_sorted=[];for(var key in items)items_sorted.push(items[key]);items_sorted.sort(function(a,b){return a.sort_order-b.sort_order});items_sorted=items_sorted.map(function(item){return item.id;});return items_sorted;};this.countItems=function(items){return Object.keys(items).length;};this.setLayoutAction=function(action,data){var state=this.getState();data.page_id=state.session['page_id'];this.action_pending.push({action:action,data:data});};this.updateLayout=function(){var state=JSON.parse(JSON.stringify(this.getState()));if(this.action_pending.length>0){var layout={};for(page_id in state.layout.pages){this.flattenLayout(state.layout.pages[page_id],'children',layout);}
for(i in this.action_pending){var action=this.action_pending[i];layout=this[action.action](action.data,layout);}
for(page_id in state.layout.pages){state.layout.pages[page_id].children=this.unflattenLayout(layout,page_id);}
this.action_pending=[];this.updateState(['layout','pages'],{});this.render();this.updateState(['layout','pages'],state.layout.pages);}};this.flattenLayout=function(tree,key,collection){if(!tree[key]||tree[key].length===0)return;var i=0;for(child_id in tree[key]){var child=tree[key][child_id];collection[child.id]=child;this.flattenLayout(child,key,collection);if(tree.id){collection[child.id].parent=tree.id;}else{collection[child.id].parent=0;}
collection[child.id].sort_order=i;i++;delete collection[child.id].children;}
return;};this.unflattenLayout=function(arr,parent_id){var nodes=[];d_quickcheckout_lodash.mapValues(arr,function(value){if(value.type!='item'){value.children=[];}
nodes.push(value);return value;});var map={};var node;var roots=[];for(var i=0;i<nodes.length;i+=1){node=nodes[i];map[node.id]=i;}
for(var i=0;i<nodes.length;i+=1){node=nodes[i];if(node.parent!=="0"){if(typeof map[node.parent]!=='undefined'){nodes[map[node.parent]].children.push(node);nodes[map[node.parent]].children.sort(function(a,b){return a.sort_order==b.sort_order?0:+(a.sort_order>b.sort_order)||-1;})}}else{roots.push(node);}}
var result=nodes.map(function(value){if(value.parent==parent_id){return value;}}).filter(function(value){return value!==undefined;});return this.toObject(result);};this.toObject=function(array){var new_array={};if(Array.isArray(array)){for(var i=0,len=array.length;i<len;i++){new_array[array[i].id]=dv_cash.extend(true,{},array[i]);if(new_array[array[i].id].children!='undefined'){new_array[array[i].id].children=this.toObject(new_array[array[i].id].children)}}}
return new_array;};this.raw=function(text){var txt=document.createElement("textarea");txt.innerHTML=text;return txt.value;};this.beforeLeave=function(){var that=this;if(this.state.edit){window.addEventListener('beforeunload',function(e){if(that.state.edited){e.preventDefault();e.returnValue='';}});}
window.addEventListener('beforeunload',function(e){that.loading(true);});};this.send=function(route,data,callback){this.showLoader();this.updateState(['notifications'],{});this.number_requests+=1;axios.post('index.php?route='+route,data).then(function(response){try{if(typeof response.data=='string'){console.error("Ajax Quick Checkout: POST /route="+route+" returned error: \n"+response.data);this.number_requests=0;this.hideLoader();return;}
callback(response.data);}catch(err){console.error("Ajax Quick Checkout: POST /route="+route+" returned error: \n"+response.data);this.number_requests=0;this.hideLoader();}
this.number_requests-=1;if(this.number_requests===0){this.hideLoader();}}.bind(this))};this.showLoader=function(){this.loading(true);var that=this;setTimeout(function(){dv_cash('.qc-loader').show();},10);};this.hideLoader=function(){this.loading(false);dv_cash('.qc-loader').hide();};this.showSpinner=function(){setTimeout(function(){dv_cash('.qc-spinner').show();},10);};this.hideSpinner=function(){dv_cash('.qc-spinner').hide();};this.isMobile=function(){if(screen.width<=480){return true;}else false;};return this;})();var d_quickcheckout=qc;(function(){this.pageCount=0;this.subscribe('setting/save',function(data){this.hideSetting();this.updateLayout();var state=this.getState();this.send('extension/module/d_quickcheckout/update',state,function(json){this.setState(json);this.render();this.hideLoader();this.state.edited=false;}.bind(this));});this.subscribe('setting/edit',function(data){this.setState(data);});this.subscribe('setting/reset',function(data){this.hideSetting();this.updateState(['layout','pages'],{});this.showSpinner();this.send('extension/module/d_quickcheckout/reset',{},function(json){this.setState(json);this.render();}.bind(this));});this.subscribe('setting/changeLayout',function(data){this.hideSetting();this.updateState(['layout','pages'],{});this.showSpinner();this.send('extension/module/d_quickcheckout/change_layout',{layout_codename:data.layout_codename},function(json){this.setState(json);this.render();}.bind(this));});this.subscribe('setting/changeSkin',function(data){this.updateState(['layout','skin'],data.skin_codename);});this.subscribe('setting/changeLanguage',function(data){var state=this.getState();state.session.language=data.language_id;this.setState(state);this.showLoader();this.send('extension/module/d_quickcheckout/change_language',{language_id:data.language_id},function(json){this.showLoader();this.send('extension/module/d_quickcheckout/get_language',{session:{language:data.language_id}},function(json){this.setState(json);}.bind(this));}.bind(this));});this.subscribe('setting/changeStore',function(data){this.showLoader();this.send('extension/module/d_quickcheckout/get_store_setting',{setting_id:data.setting_id},function(json){this.updateState(['layout'],{});this.setState(json);this.render();}.bind(this));});this.showSetting=function(setting_id){this.hideSetting();dv_cash('body').addClass('show-setting');dv_cash('#'+setting_id).addClass('show');};this.hideSetting=function(){dv_cash('body').removeClass('show-setting');dv_cash('.qc-setting').removeClass('show');};this.toggleSetting=function(){if(dv_cash('body').hasClass('popup')){dv_cash('body').removeClass('popup');}else{dv_cash('body').addClass('popup');}};this.buildStyleBySelector=function(selector,styles){var styleContainer=selector+' { ';for(key in styles){styleContainer+=key+':'+styles[key]+';'}
styleContainer+=' } ';return styleContainer;};this.updateLayoutStyle=function(){var that=this;axios.get('catalog/view/theme/default/stylesheet/d_quickcheckout/skin/'+this.getLayout().skin+'/'+this.getLayout().skin+'.css?'+this.rand()).then(function(response){dv_cash('html > head').find('[title="d_quickcheckout"]').remove();var style='<style title="d_quickcheckout">';style+=this.buildStyleBySelector('body > div, body > nav, body > header, body > footer, body > section, body > article, body > table, body > span, body > pre, body > template',{'display':(this.getLayout().header_footer==1)?'block':'none'})
style+=this.buildStyleBySelector('body > d_quickcheckout',{'padding':(this.getLayout().header_footer==1)?'0px':'40px','display':(this.getLayout().header_footer==1)?'block':'block'})
style+='</style>';dv_cash('html > head').append(dv_cash(style));if(this.getLayout().header_footer!=1){dv_cash('body').prepend(dv_cash('#d_quickcheckout'));}else{dv_cash('.qc-spinner').after(dv_cash('#d_quickcheckout'));}});};alertify.getPro||alertify.dialog('getPro',function(){return{main:function(content){this.setContent(content);},setup:function(){return{focus:{element:function(){return this.elements.body.querySelector(this.get('selector'));},select:true},options:{basic:true,maximizable:false,resizable:false,padding:false}};},settings:{selector:undefined}};});this.subscribe('setting/updateCommon',function(json){if(json['text_account_login']){dv_cash('#top-links > ul > li:nth-child(2)').html(json['text_account_login']);}
if(json['cart_total_text']){dv_cash('#cart > button').html('<span id="cart-total"><i class="fa fa-shopping-cart"></i> '+json['cart_total_text']+'</span>');axios.get('index.php?route=common/cart/info').then(function(response){var parser=new DOMParser();var doc=parser.parseFromString(response.data,"text/html");if(doc.querySelector('ul li')){dv_cash('#cart > ul').html(doc.querySelector('ul li').outerHTML);}});}});})(qc);dv_cash(document).on('click','.qc-tab',function(){dv_cash('.qc-tab').removeClass('active');dv_cash(this).addClass('active');var tab_id=dv_cash(this).find('a').attr('href');dv_cash(tab_id).parents('.qc-setting-tab-content').find('.qc-setting-tab-pane').removeClass('in').removeClass('active').hide();dv_cash(tab_id).addClass('in').addClass('active').show();return false;});(function(){this.subscribe('page/sort',function(){var state={};state.layout=this.getLayout();dv_cash('.page-nav > .page-nav-item').each(function(i){state.layout.pages[dv_cash(this).attr('page_id')].sort_order=String(i);});this.setState(state);});this.subscribe('page/add',function(){var state=this.getState();var sort_order=Object.keys(state.layout.pages).length;var page_id='page'+this.rand();state.layout.pages[page_id]={'id':page_id,'children':{},'deleted':0,'sort_order':sort_order,'type':'page','display':1,'text':'New page','description':'New page description'}
dv_cash('.page-nav > .page-nav-item').each(function(i){if(state.layout.pages[dv_cash(this).attr('page_id')]){state.layout.pages[dv_cash(this).attr('page_id')].sort_order=i;}});state.session.page_id=page_id;this.setState(state);state.session.pages.push(page_id);var pages=state.session.pages;pages=pages.filter(function(i){return i!==false});this.updateState(['session','pages'],pages);});this.subscribe('page/remove',function(data){var state=this.getState();state.layout.pages[data.page_id].deleted=1;this.setState(state);var pages=state.session.pages;pages=pages.filter(function(i){return i!==data.page_id&&i!==false});this.updateState(['session','pages'],pages);var last_page='';dv_cash.each(pages,function(i,e){if(state.layout.pages[e]){state.layout.pages[e].sort_order=i;}
last_page=e;});if(data.page_id==state.session.page_id){this.updateState(['session','page_id'],last_page);}});this.subscribe('page/open',function(data){if(data.page_id){var state={'session':{'page_id':data.page_id}};this.setState(state);this.send('extension/module/d_quickcheckout/update',state,function(json){}.bind(this));}});this.getPageIds=function(){var pages_sorted=[];for(var key in this.getLayout().pages)pages_sorted.push(this.getLayout().pages[key]);pages_sorted.sort(function(a,b){return parseInt(a.sort_order)-parseInt(b.sort_order)});var result=pages_sorted.map(function(page){return page.id;});return result;};this.hasPayment=function(){var layoutString=JSON.stringify(this.getState().layout.pages);return(layoutString.indexOf('payment"')==-1);};this.goToPageNav=function(){if(this.isMobile()){setTimeout(function(){document.querySelector('html, body').scroll({behavior:'smooth',top:document.querySelector('.process-page').offsetTop-60});},10);}};})(qc);(function(){this.subscribe('row/add',function(data){var state=this.getState();var row_id='row'+this.rand();var layout={};var page=dv_cash.extend(true,{},state.layout.pages[state.session['page_id']]);this.flattenLayout(page,'children',layout);layout[row_id]={'id':row_id,'parent':data.parent,'sort_order':data.sort_order,'children':{},'type':'row'};var col_id='col'+this.rand();layout[col_id]={'id':col_id,'parent':row_id,'sort_order':0,'children':{},'size':12,'type':'col'};page=this.unflattenLayout(layout,state.session['page_id']);this.updateState(['layout','pages',state.session['page_id'],'children'],page);});this.subscribe('row/remove',function(data){dv_cash('#'+data.row_id).hide();this.setLayoutAction('rowRemove',data);});this.rowRemove=function(data,layout){delete layout[data.row_id]
return layout;};})(qc);(function(){this.subscribe('col/add',function(data){var state=this.getState();var col_id='col'+this.rand();var layout={};var page=dv_cash.extend(true,{},state.layout.pages[state.session['page_id']]);this.flattenLayout(page,'children',layout);layout[col_id]={'id':col_id,'parent':data.parent,'sort_order':data.sort_order,'children':{},'size':12,'type':'col'}
page=this.unflattenLayout(layout,state.session['page_id']);this.updateState(['layout','pages',state.session['page_id'],'children'],page);});this.subscribe('col/remove',function(data){var state=this.getState();var layout={};var page=dv_cash.extend(true,{},state.layout.pages[state.session['page_id']]);this.flattenLayout(page,'children',layout);if(data.sort_order<2){delete layout[layout[data.col_id].parent];}
delete layout[data.col_id];page=this.unflattenLayout(layout,state.session['page_id']);this.updateState(['layout','pages',state.session['page_id'],'children'],page);});this.subscribe('col/resize',function(data){clearTimeout(this.step_resize_timer);this.step_resize_timer=setTimeout(function(){var state=this.getState();var layout={};var page=dv_cash.extend(true,{},state.layout.pages[state.session['page_id']]);this.flattenLayout(page,'children',layout);layout[data.item_id].size=data.width;page=this.unflattenLayout(layout,state.session['page_id']);this.updateState(['layout','pages',state.session['page_id'],'children'],page);},1000);});})(qc);(function(){this.data_pending=[];this.subscribe('step/add',function(data){var state=this.getState();var item_id='item'+this.rand();var layout={};var page=dv_cash.extend(true,{},state.layout.pages[state.session['page_id']]);this.flattenLayout(page,'children',layout);layout[item_id]={'id':item_id,'parent':data.parent,'sort_order':data.sort_order,'name':data.name,'type':'item'}
page=this.unflattenLayout(layout,state.session['page_id']);this.updateState(['layout','pages',state.session['page_id'],'children'],page);});this.subscribe('step/remove',function(data){dv_cash('#'+data.step_id).remove();this.setLayoutAction('stepRemove',data);});this.stepRemove=function(data,layout){delete layout[data.step_id];return layout;};this.subscribe('step/move',function(data){this.setLayoutAction('stepMove',data);});this.stepMove=function(data,layout){layout[data.item_id].parent=data.col_id;dv_cash('#'+data.col_id).children('.gr-col-content').children('*').each(function(child_id,child){if(layout[child.id]){layout[child.id].sort_order=child_id;}});return layout;};})(qc);(function(){this.initFieldSortable=function(step_id){var that=this;d_quickcheckout_sortable('#'+step_id+'_fields',{handle:'.handle-sortable',placeholderClass:'ui-sortable-placeholder'}).forEach(item=>{item.addEventListener('sortupdate',function(event){var IDs=[];dv_cash('#'+step_id+'_fields').find(".qc-field").each(function(){IDs.push(dv_cash(this).attr('field_id'));});var state=that.getState();for(var key in IDs){state.config['guest'][step_id].fields[IDs[key]].sort_order=parseInt(key);state.config['register'][step_id].fields[IDs[key]].sort_order=parseInt(key);state.config['logged'][step_id].fields[IDs[key]].sort_order=parseInt(key);that.updateState(['config','guest',step_id,'fields',IDs[key],'sort_order'],parseInt(key),false);that.updateState(['config','register',step_id,'fields',IDs[key],'sort_order'],parseInt(key),false);that.updateState(['config','logged',step_id,'fields',IDs[key],'sort_order'],parseInt(key),false);}});});};this.getFieldIds=function(step_id){var fields_sorted=[];for(var key in this.getConfig()[step_id].fields){if(this.getConfig()[step_id].fields[key].type){fields_sorted.push(this.getConfig()[step_id].fields[key]);}}
fields_sorted.sort(function(a,b){return a.sort_order-b.sort_order});return fields_sorted.map(function(field){return field.id;});};this.getCustomField=function(data){this.send('extension/module/d_quickcheckout/get_custom_fields',data,function(custom_fields){this.setState({'custom_fields':custom_fields});}.bind(this));};this.addCustomField=function(step,custom_field_id){var state=this.getState();var custom_field=state.custom_fields.find(function(custom_field){return custom_field.custom_field_id===custom_field_id;})
var field_id='custom-'+custom_field.location+'-'+custom_field.custom_field_id;var sort_order=Object.keys(state.config.guest[step].fields).length;var format='';if(custom_field.type=='date'){format='d-m-y'}
if(custom_field.type=='time'){format='H:i'}
if(custom_field.type=='datetime'){format='d-m-y H:i'}
var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){state.config[accounts[i]][step].fields[field_id]={'id':field_id,'custom_field_id':custom_field.custom_field_id,'text':'entry_'+field_id,'placeholder':'placeholder_'+field_id,'display':1,'require':custom_field.required,'tooltip':'tooltip_'+field_id,'errors':{'error0':{'not_empty':true,'text':'error_'+field_id+'_not_empty'}},'type':custom_field.type,'options':custom_field.options,'refresh':0,'custom':1,'location':custom_field.location,'custom_field_id':custom_field.custom_field_id,'sort_order':sort_order,'format':format,'class':'','value':'','mask':'',}}
state.language[step]['entry_'+field_id]=custom_field.name;state.language[step]['placeholder_'+field_id]=custom_field.name;state.language[step]['tooltip_'+field_id]='';state.language[step]['error_'+field_id+'_min_length']=state.language.general['error_min_length'];state.language[step]['error_'+field_id+'_max_length']=state.language.general['error_max_length'];this.setState(state);};this.deleteCustomField=function(step,custom_field_id){var state=this.getState();var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){delete state.config[accounts[i]][step].fields[custom_field_id];this.updateState(['config',accounts[i],step,'fields'],state.config[accounts[i]][step].fields);}};this.subscribe('field/addDepend',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var depend_id=data.depend_id;var depend_value_id=this.rand();var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){if(typeof state.config[accounts[i]][step_id].fields[field_id].depends=='undefined'){state.config[accounts[i]][step_id].fields[field_id].depends={};}
state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]={};this.updateState(['config',accounts[i],step_id,'fields',field_id,'depends',depend_id],state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]);}
this.setState(state);});this.subscribe('field/removeDepend',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var depend_id=data.depend_id;var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){if(typeof state.config[accounts[i]][step_id].fields[field_id].depends!=='undefined'&&typeof state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]!=='undefined'){delete state.config[accounts[i]][step_id].fields[field_id].depends[depend_id];if(!Object.keys(state.config[accounts[i]][step_id].fields[field_id].depends).length){delete state.config[accounts[i]][step_id].fields[field_id].depends;this.updateState(['config',accounts[i],step_id,'fields',field_id],state.config[accounts[i]][step_id].fields[field_id]);}else{this.updateState(['config',accounts[i],step_id,'fields',field_id,'depends'],state.config[accounts[i]][step_id].fields[field_id].depends);}}}});this.subscribe('field/addDependValue',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var depend_id=data.depend_id;var depend_value_id=this.rand();var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){if(typeof state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]!=='undefined'){state.config[accounts[i]][step_id].fields[field_id].depends[depend_id][depend_value_id]=JSON.parse('{ "value": "", "display" : "1", "require" : "0"}');this.updateState(['config',accounts[i],step_id,'fields',field_id,'depends',depend_id,depend_value_id],state.config[accounts[i]][step_id].fields[field_id].depends[depend_id][depend_value_id]);}}});this.subscribe('field/removeDependValue',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var depend_id=data.depend_id;var depend_value_id=data.depend_value_id;var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){if(typeof state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]!=='undefined'){delete state.config[accounts[i]][step_id].fields[field_id].depends[depend_id][depend_value_id];this.updateState(['config',accounts[i],step_id,'fields',field_id,'depends',depend_id],state.config[accounts[i]][step_id].fields[field_id].depends[depend_id]);}}});this.subscribe('field/addError',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var error_id=this.rand();var error_type=data.error_type;var accounts=['guest','register','logged'];state.language[step_id]['text_'+field_id+'_'+error_id]=state.language.general['error_'+error_type];this.setState(state);for(i=0;i<accounts.length;i++){if(typeof state.config[accounts[i]][step_id].fields[field_id].errors=='undefined'){state.config[accounts[i]][step_id].fields[field_id].errors={};}
state.config[accounts[i]][step_id].fields[field_id].errors[error_id]={};state.config[accounts[i]][step_id].fields[field_id].errors[error_id][error_type]=true;state.config[accounts[i]][step_id].fields[field_id].errors[error_id]['text']='text_'+field_id+'_'+error_id;this.updateState(['config',accounts[i],step_id,'fields',field_id,'errors'],state.config[accounts[i]][step_id].fields[field_id].errors);}});this.subscribe('field/removeError',function(data){var state=this.getState();var step_id=data.step_id;var field_id=data.field_id;var error_id=data.error_id;var accounts=['guest','register','logged'];for(i=0;i<accounts.length;i++){delete state.config[accounts[i]][step_id].fields[field_id].errors[error_id];this.updateState(['config',accounts[i],step_id,'fields',field_id,'errors'],state.config[accounts[i]][step_id].fields[field_id].errors);}});})(qc);(function(){this.validate=function(value,errors){var result=false;dv_cash.each(errors,function(i,error){for(rule in error){if(typeof this[rule]!=="undefined"){if(!this[rule](error[rule],value)){result=error.text;}}}}.bind(this));return result;}
this.not_empty=function(rule,value){return(value.length>0);}
this.min_length=function(rule,value){return(value.length>=rule);}
this.max_length=function(rule,value){return(value.length<=rule);}
this.checked=function(rule,value){return(value);}
this.compare_to=function(rule,value){var parts=rule.split('.');var session=this.getSession();return(session[parts[0]][parts[1]]==value);}
this.telephone=function(rule,value){return true;}
this.email_exists=function(rule,value){return true;}
this.regex=function(rule,value){rule.split('/');rule=new RegExp(rule[1],'i');return(value.match(rule));}
this.text=function(rule,value){return rule;}
this.goToError=function(){setTimeout(function(){if(this.getState()['captcha_status']==1&&this.in_array(this.getAccount(),this.getState()['config_captcha_page'])&&this.getState()['captcha_type']=='google'){dv_cash('textarea[name="g-recaptcha-response"]').val('');var sitekey=dv_cash('#input-payment-captcha').attr('data-sitekey');dv_cash('#gRecaptcha').html('');dv_cash('#gRecaptcha').html('<script src="//www.google.com/recaptcha/api.js" type="text/javascript"></script><input type="text" style="display: none;" no-reorder="" id="payment_address_google_recaptcha" name="payment_address[google_recaptcha]" class="ve-input d-vis validate qc-required google_recaptcha google_recaptcha"><div id="input-payment-captcha" class="g-recaptcha" data-sitekey="'+sitekey+'" change></div>');}
document.querySelector('html, body').scroll({behavior:'smooth',top:document.querySelector('.ve-field--error').offsetTop-60});},10);}})(qc);(function(){this.subscribe('account/update',function(data){this.setState({'session':data},false);var difference=this.getChange();this.send('extension/d_quickcheckout/account/update',difference,function(json){this.setState(json);this.dispatch('account/updated',json);this.setChange(this.getState());}.bind(this));});this.subscribe('account/login',function(data){this.setState({'session':data},false);this.send('extension/d_quickcheckout/account/update',{'session':data},function(json){this.setState(json);this.dispatch('account/updated',json);this.dispatch('setting/updateCommon',json);this.setChange(this.getState());}.bind(this));});this.subscribe('account/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('payment_address/update',function(data){if(data.payment_address.shipping_address&&this.getState().session.has_shipping){if(data.payment_address.shipping_address==1){this.updateState(['config',this.getAccount(),'shipping_address','display'],0,false);}else{this.updateState(['config','guest','shipping_address','display'],1,false);this.updateState(['config','logged','shipping_address','display'],1,false);this.updateState(['config','register','shipping_address','display'],1,false);}}else if(!this.getState().session.has_shipping){this.updateState(['config',this.getAccount(),'shipping_address','display'],0,false);}
clearTimeout(this.payment_address_timer);this.setState({'session':data},false);var data_to_update={session:{payment_address:this.getSession().payment_address,}};this.payment_address_timer=setTimeout(function(){this.send('extension/d_quickcheckout/payment_address/update',data_to_update,function(json){if(json?.session?.payment_methods){this.updateState(['session','payment_methods'],json['session']['payment_methods'],false);}
if(json?.session?.shipping_methods){this.updateState(['session','shipping_methods'],json['session']['shipping_methods'],false);}
this.setState(json);this.setChange(this.getState());}.bind(this));},20);});this.subscribe('payment_address/error',function(data){var state={'errors':{'payment_address':{}}}
state['errors']['payment_address'][data.field_id]=data.error;this.setState(state);});this.subscribe('payment_address/edit',function(data){this.setState(data);});this.subscribe('payment_address/upload_file',function(data){dv_cash('#button-payment-custom-field'+data.id).prop('disabled',true);var form_data=new FormData();for(var key in data){form_data.append(key,data[key]);}
axios.post('index.php?route=tool/upload',form_data).then(function(response){var json=response.data;dv_cash('#button-payment-custom-field'+data.id).parent().find('.text-danger').remove();if(json['error']){dv_cash('#button-payment-custom-field'+data.id).parent().find(dv_cash('#'+data.step+data.field)).after('<div class="text-danger">'+json['error']+'</div>');}
if(json['success']){alert(json['success']);dv_cash('#button-payment-custom-field'+data.id).parent().find(dv_cash('#'+data.step+data.field)).val(json['code']);var state={'payment_address':{}}
state['payment_address'][data.field]=json['code'];this.dispatch('payment_address/update',state);}
dv_cash('#button-payment-custom-field'+data.id).prop('disabled',false);}).catch(function(error){dv_cash('#button-payment-custom-field'+data.id).prop('disabled',false);console.error(error)});});})(qc);(function(){this.subscribe('shipping_address/update',function(data){clearTimeout(this.shipping_address_timer);this.setState({'session':data},false);var data_to_update={session:{shipping_address:this.getSession().shipping_address,}};this.shipping_address_timer=setTimeout(function(){this.send('extension/d_quickcheckout/shipping_address/update',data_to_update,function(json){if(json?.session?.payment_methods){this.updateState(['session','payment_methods'],json['session']['payment_methods'],false);}
if(json?.session?.shipping_methods){this.updateState(['session','shipping_methods'],json['session']['shipping_methods'],false);}
this.setState(json);this.setChange(this.getState());}.bind(this));},20);});this.subscribe('shipping_address/error',function(data){var state={'errors':{'shipping_address':{}}}
state['errors']['shipping_address'][data.field_id]=data.error;this.setState(state);});this.subscribe('shipping_address/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('custom/update',function(data){clearTimeout(this.custom_timer);this.setState({'session':data},false);var data_to_update={session:{custom:this.getSession().custom,}};this.custom_timer=setTimeout(function(){this.send('extension/d_quickcheckout/custom/update',data_to_update,function(json){this.setState(json);this.setChange(this.getState());}.bind(this));},10);});this.subscribe('custom/error',function(data){var state={'errors':{'custom':{}}}
state['errors']['custom'][data.field_id]=data.error;this.setState(state);});this.subscribe('custom/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('shipping_method/update',function(data){this.send('extension/d_quickcheckout/shipping_method/update',data,function(json){this.setState(json);}.bind(this));});this.subscribe('shipping_method/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('payment_method/update',function(data){this.send('extension/d_quickcheckout/payment_method/update',data,function(json){this.setState(json);}.bind(this));});this.subscribe('payment_method/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('cart/update',function(data){clearTimeout(this.cart_timer);this.cart_timer=setTimeout(function(){this.send('extension/d_quickcheckout/cart/update',data,function(json){if(json?.session?.payment_methods){this.updateState(['session','payment_methods'],json['session']['payment_methods'],false);}
if(json?.session?.shipping_methods){this.updateState(['session','shipping_methods'],json['session']['shipping_methods'],false);}
this.setState(json);this.dispatch('setting/updateCommon',json);}.bind(this));},500);});this.subscribe('cart/update_option',function(data){clearTimeout(this.cart_timer);this.cart_timer=setTimeout(function(){this.send('extension/d_quickcheckout/cart/update',data,function(json){this.setState(json);this.updateState(['session','cart'],json.session.cart);this.dispatch('setting/updateCommon',json);}.bind(this));},10);});this.subscribe('cart/edit',function(data){this.setState(data);});})(qc);(function(){this.subscribe('confirm/confirm',function(data){this.updateState(['session','confirm','loading'],true);setTimeout(function(){this.send('extension/d_quickcheckout/confirm/update',data,function(json){this.setState(json);if(!json.session.confirm.checkout){this.goToError();}else{this.updateState(['session','confirm','checkout'],false);this.dispatch('setting/updateCommon',json);this.setState(json);this.setChange(this.getState());this.loading(true);setTimeout(function(){var href=dv_cash(json.session.confirm.trigger,dv_cash('#payment')).attr('href');if(href!=''&&href!=undefined){document.location.href=href;}else{if(getSession().payment.payment_popup==true){DvDialogify().initModal('#payment_modal').show();}else{dv_cash(json.session.confirm.trigger,dv_cash('#payment')).trigger('click');}}},100);}}.bind(this));},500);});this.subscribe('confirm/next',function(data){clearTimeout(this.continue_timer);setTimeout(function(){var current_page_id=this.getSession().page_id;var data={page_id:current_page_id};this.continue_timer=setTimeout(function(){this.send('extension/d_quickcheckout/confirm/update',data,function(json){this.setState(json);this.setChange(this.getState());if(current_page_id==this.getSession().page_id){this.goToError();}else{this.goToPageNav();}}.bind(this));},11);},500);});this.subscribe('confirm/prev',function(){var pages=this.getSession().pages;var current_page_id=this.getSession().page_id;var prev_page_index=pages.indexOf(current_page_id)-1;var prev_page_id=pages[prev_page_index];if(prev_page_id){var state={'session':{'page_id':prev_page_id}};this.setState(state);this.send('extension/module/d_quickcheckout/update',state,function(json){}.bind(this));}});this.subscribe('confirm/edit',function(data){this.setState(data);});})(qc);